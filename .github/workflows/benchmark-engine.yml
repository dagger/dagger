name: Benchmark

on:
  # Run the workflow every day at 5AM UTC
  # That's 9PM PST, 12AM EST, 6AM CET
  schedule:
    - cron: "0 5 * * *"
  pull_request:
    types:
      - synchronize
      - labeled
  # Enable manual trigger for easy debugging
  workflow_dispatch:

permissions:
  contents: read

concurrency:
  group: ${{ github.workflow }}-${{ github.head_ref || github.run_id }}
  cancel-in-progress: true

jobs:
  benchdev:
    if: ${{ github.repository == 'dagger/dagger' && (github.event_name != 'pull_request' || contains(github.event.pull_request.labels.*.name, 'benchmark')) }}
    runs-on: dagger-g3-main-16c-st-benchmark
    timeout-minutes: 10
    steps:
      - uses: actions/checkout@v4
      - name: "benchmark"
        shell: bash
        run: |
          dagger call test all --bench
