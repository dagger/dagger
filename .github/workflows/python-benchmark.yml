name: Python Debug Benchmark

on:
  workflow_dispatch:

permissions:
  contents: read
  pull-requests: write

concurrency:
  group: ${{ github.workflow }}-${{ github.head_ref || github.run_id }}
  cancel-in-progress: true

jobs:
  benchmark:
    runs-on: "dagger-g2-main-4c"
    timeout-minutes: 10

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: 
        shell: bash
        run: |
          mkdir -p /tmp/benchmark
          cp -a perf-test /tmp/benchmark

      - name: First call
        shell: bash
        working-directory: /tmp/benchmark/perf-test
        run: |
          dagger call sleep
        env:
          DAGGER_CLOUD_TOKEN: "dag_dagger_sBIv6DsjNerWvTqt2bSFeigBUqWxp9bhh3ONSSgeFnw"

      - name: Cached call
        shell: bash
        working-directory: /tmp/benchmark/perf-test
        run: |
          dagger call sleep
        env:
          DAGGER_CLOUD_TOKEN: "dag_dagger_sBIv6DsjNerWvTqt2bSFeigBUqWxp9bhh3ONSSgeFnw"
