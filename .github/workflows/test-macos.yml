name: test
on:
  pull_request:
  # Enable manual trigger for easy ad-hoc debugging
  # https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#onworkflow_dispatchinputs
  workflow_dispatch:
jobs:
  # mac-os:
  # name: macOS with Docker
  # runs-on: macos-latest
  # steps:
  sdk-macos:
    timeout-minutes: 40
    name: sdk / macos-tests
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v3
      # Install SDK tests requirements
      - uses: actions/setup-go@v3
        with:
          go-version: 1.19
      - uses: snok/install-poetry@v1 # Install Poetry
      # Start headless Docker Desktop
      - uses: docker-practice/actions-setup-docker@master
        with:
          timeout-minutes: 15
      - name: Check that docker version works # https://github.com/docker-practice/actions-setup-docker
        run: |
          set -x
          docker version
      # Local runs of SDK tests
      - name:
          Manual Go SDK test
          # cd sdk/go && go test -p 16 -timeout 99999s -v ./...
        run: |
          cd sdk/go && go test -count=1 -run=TestImageProvision -timeout 99999s -v ./...
      - name: Manual Python SDK test
        run: |
          cd sdk/python && poetry run poe test
