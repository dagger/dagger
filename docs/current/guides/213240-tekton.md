---
slug: /213240/tekton
---

Outline:

Requirements: Existing k8s cluster with tekton installed. Note this does not require
the dagger helm chart. This can be used as-is with tekton.
[Tekton Getting Started](https://tekton.dev/docs/getting-started/)

The snippets: (should probably rename these files)
dagger-task.yaml: This task runs a dagger pipeline for the project we check out in
the tekton pipeline (described later). The dagger pipeline is run with `npm run ci`.
The dagger engine is run as a sidecar here and shares a socket with the task itself.
The task uses dind as it's runtime in order to have the docker dependency.

git-pipeline.yaml: This Pipeline takes some inputs, does a git checkout into a Workspace
which is a Tekton thing to share files between tasks, and then runs our dagger task.

git-pipeline-run.yaml: This is the PipelineRun for the Pipeline. Basically creates
an execution for the pipeline with a given set of inputs. Note that the cloud token
should be set here or pulled from a k8s secret.

The flow:
1. Install the `git-clone` task from Tekton Hub. `tkn hub install task git-clone`.
This is used to clone the git repo in `git-pipeline.yaml`.
2. Setup cloud token as a k8s secret?
3. Apply the Task and Pipeline.
    - `kubectl apply -f dagger-task.yaml`
    - `kubectl apply -f git-pipeline-yaml`
4. Run the pipeline.
    - `kubectl create -f git-pipeline-run.yaml`

