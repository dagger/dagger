---
slug: /api/caching
---

# Caching

Dagger caches two types of data:

1. Layers: This refers to build instructions and the results of some API calls. This cache is implemented by Buildkit.
2. Volumes: This refers to the contents of a Dagger filesystem volume and is persisted across Dagger Engine sessions. This cache is maintained locally and, where applicable, replicated to Dagger Cloud. It is implemented by Dagger (distinct from Buildkit).

Volume caching is especially useful when dealing with package managers such as `npm`, `maven`, `pip` and similar. For these tools to cache properly, they need their own cache data (usually a directory) to be persisted between runs. By using a cache volume for this data, Dagger can reuse the cached contents across Dagger Function runs and reduce execution time.

## Caching in Dagger Cloud

Dagger Cloud automatically detects and creates cache volumes when they are declared in your custom Dagger Functions.

Your cache volumes will appear in the UI within a few minutes after your Dagger Function has completed execution. If you don't see them in the UI, ensure you've referenced the volumes correctly in your Dagger Function code and that you've set up your CI or local development workflows to push the cache volumes to Dagger Cloud.

To see your cache volumes, browse to the **Organization Settings** page of the Dagger Cloud dashboard (accessible by clicking your user profile icon in the Dagger Cloud interface) and navigate to the **Configuration** tab. You should see the newly-created volumes listed and enabled.

![Manage volumes](/img/current_docs/api/manage-volumes.png)

You can create as many volumes as needed and manage them from the **Configuration** tab of your Dagger Cloud organization page.

:::tip
If you've configured cache volumes for the first time in a local development environment, call your Dagger Function via the Dagger CLI and then run the command `docker container stop -t 300 "$(docker container list --filter 'name=^dagger-engine-*' -q)"`. This step ensures your new cache volumes populate to Dagger Cloud during the engine shutdown phase. You only need to do this the first time you use Dagger Cloud locally with cache volumes or when you add new cache volumes in your Dagger pipeline.
:::

### Implementation

Both cache mechanisms are namespaced by Dagger Cloud Organization name.
- The cache key for the layers cache is `bucket / organization-name / content-address`.
- The cache key for the volumes cache is `bucket / organization-name / volume-name`, where the volume name is set by the user using the Dagger API.
- Manifests of the layers cache are sent to Dagger Cloud to support merging layers between runs (not supported by Buildkit).

The cache is shared across pipelines and runs, within the same Dagger Cloud organization. This implies that users in the same organization share the same cache.

:::important
No cache data is shared across organizations.
:::

### Security

Both caching mechanisms use an object store (S3 or S3-compatible).

Data is encrypted in transit (the transport layer is HTTPS/TLS) and at rest (read more about data encryption in [CloudFlare R2](https://developers.cloudflare.com/r2/reference/data-security/), [AWS S3](https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-bucket-intro.html) and [Google Cloud Storage](https://cloud.google.com/docs/security/encryption/default-encryption)).

## Layer cache invalidation

It may sometimes be necessary to explicitly force execution of specific pipeline steps, bypassing the Dagger layer cache. The typical approach for this is to invalidate the Dagger layer cache by introducing a volatile time variable at a specific point in the Dagger pipeline.

Here is a simple example using the Dagger CLI:

```shell
dagger core container \
  from --address=alpine:latest \
  with-env-variable --name="CACHE_BUST" --value=`(date +%s)` \
  with-exec --args="date"  \
  stdout
```

In its current form, this example invalidates the cache by printing a different date and time value on every run. However, if the `CACHE_BUST` environment variable is removed, the same value (the date and time on the first run) is printed on every run.

You can also see an [example of invalidating the layer cache in a Dagger Function](../cookbook/cookbook.mdx#invalidate-cache).
