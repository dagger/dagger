---
title: "Build"
slug: /cookbook/build
description: "Learn how to build and test your applications using Dagger with practical examples."
sidebar_label: "Build"
---



### Perform a multi-stage build

The following Dagger Function performs a multi-stage build.

<Tabs groupId="language" queryString="sdk">
<TabItem value="go" label="Go">

```go file=./snippets/builds/multi-stage-build/go/main.go
```

</TabItem>
<TabItem value="python" label="Python">

```python file=./snippets/builds/multi-stage-build/python/main.py
```

</TabItem>
<TabItem value="typescript" label="TypeScript">

```typescript file=./snippets/builds/multi-stage-build/typescript/index.ts
```

</TabItem>
<TabItem value="php" label="PHP">

```php file=./snippets/builds/multi-stage-build/php/src/MyModule.php
```

</TabItem>
</Tabs>

#### Example

Perform a multi-stage build of the source code in the `golang/example/hello` repository and publish the resulting image:

    <Tabs groupId="shell">
    <TabItem value="System shell">
    ```shell
    dagger -c 'build https://github.com/golang/example#master:hello'
    ```
    </TabItem>
    <TabItem value="Dagger Shell">
    ```shell title="First type 'dagger' for interactive mode."
    build https://github.com/golang/example#master:hello
    ```
    </TabItem>
    <TabItem value="Dagger CLI">
    ```shell
    dagger call build --src="https://github.com/golang/example#master:hello"
    ```
    </TabItem>
    </Tabs>

### Perform a matrix build

The following Dagger Function performs a matrix build.

<Tabs groupId="language" queryString="sdk">
<TabItem value="go" label="Go">

```go file=./snippets/builds/matrix-build/go/main.go
```

</TabItem>
<TabItem value="python" label="Python">

```python file=./snippets/builds/matrix-build/python/main.py
```

</TabItem>
<TabItem value="typescript" label="TypeScript">

```typescript file=./snippets/builds/matrix-build/typescript/index.ts
```

</TabItem>
<TabItem value="php" label="PHP">

```php file=./snippets/builds/matrix-build/php/src/MyModule.php
```

</TabItem>
</Tabs>

#### Example

Perform a matrix build of the source code in the `golang/example/hello` repository and export build directory with go binaries for different operating systems and architectures.

    <Tabs groupId="shell">
    <TabItem value="System shell">
    ```shell
    dagger -c 'build https://github.com/golang/example#master:hello | export /tmp/matrix-builds'
    ```
    </TabItem>
    <TabItem value="Dagger Shell">
    ```shell title="First type 'dagger' for interactive mode."
    build https://github.com/golang/example#master:hello | export /tmp/matrix-builds
    ```
    </TabItem>
    <TabItem value="Dagger CLI">
    ```shell
    dagger call \
      build --src="https://github.com/golang/example#master:hello" \
      export --path=/tmp/matrix-builds
    ```
    </TabItem>
    </Tabs>

Inspect the contents of the exported directory with `tree /tmp/matrix-builds`. The output should look like this:

```shell
/tmp/matrix-builds
└── build
    ├── darwin
    │   ├── amd64
    │   │   └── hello
    │   └── arm64
    │       └── hello
    └── linux
        ├── amd64
        │   └── hello
        └── arm64
            └── hello

8 directories, 4 files
```

### Build multi-arch image

The following Dagger Function builds a single image for different CPU architectures using native emulation.

<Tabs groupId="language" queryString="sdk">
<TabItem value="go" label="Go">

```go file=./snippets/builds/multi-arch/go/main.go
```

</TabItem>
<TabItem value="python" label="Python">

```python file=./snippets/builds/multi-arch/python/main.py
```

</TabItem>
<TabItem value="typescript" label="TypeScript">

```typescript file=./snippets/builds/multi-arch/typescript/index.ts
```

</TabItem>
</Tabs>

#### Example

Build and publish a multi-platform image:

    <Tabs groupId="shell">
    <TabItem value="System shell">
    ```shell
    dagger -c 'build https://github.com/golang/example#master:hello'
    ```
    </TabItem>
    <TabItem value="Dagger Shell">
    ```shell title="First type 'dagger' for interactive mode."
    build https://github.com/golang/example#master:hello
    ```
    </TabItem>
    <TabItem value="Dagger CLI">
    ```shell
    dagger call build --src="https://github.com/golang/example#master:hello"
    ```
    </TabItem>
    </Tabs>

### Build multi-arch image with cross-compliation

The following Dagger Function builds a single image for different CPU architectures using cross-compilation.

:::info
This Dagger Function uses the `containerd` utility module. To run it locally
install the module first with `dagger install github.com/levlaz/daggerverse/containerd@v0.1.2`
:::

<Tabs groupId="language" queryString="sdk">
<TabItem value="go" label="Go">

```go file=./snippets/builds/multi-arch-cc/go/main.go
```

</TabItem>
<TabItem value="python" label="Python">

```python file=./snippets/builds/multi-arch-cc/python/main.py
```

</TabItem>
<TabItem value="typescript" label="TypeScript">

```typescript file=./snippets/builds/multi-arch-cc/typescript/index.ts
```

</TabItem>
</Tabs>

#### Example

Build and publish a multi-platform image with cross compliation:

    <Tabs groupId="shell">
    <TabItem value="System shell">
    ```shell
    dagger -c 'build https://github.com/golang/example#master:hello'
    ```
    </TabItem>
    <TabItem value="Dagger Shell">
    ```shell title="First type 'dagger' for interactive mode."
    build https://github.com/golang/example#master:hello
    ```
    </TabItem>
    <TabItem value="Dagger CLI">
    ```shell
    dagger call build --src="https://github.com/golang/example#master:hello"
    ```
    </TabItem>
    </Tabs>

### Build image from Dockerfile

The following Dagger Function builds an image from a Dockerfile.

<Tabs groupId="language" queryString="sdk">
<TabItem value="go" label="Go">

```go file=./snippets/builds/dockerfile/go/main.go
```

</TabItem>
<TabItem value="python" label="Python">

```python file=./snippets/builds/dockerfile/python/main.py
```

</TabItem>
<TabItem value="typescript" label="TypeScript">

```typescript file=./snippets/builds/dockerfile/typescript/index.ts
```

</TabItem>
<TabItem value="php" label="PHP">

```php file=./snippets/builds/dockerfile/php/src/MyModule.php
```

</TabItem>
</Tabs>

#### Example
Build and publish an image from an existing Dockerfile

    <Tabs groupId="shell">
    <TabItem value="System shell">
    ```shell
    dagger -c 'build https://github.com/dockersamples/python-flask-redis'
    ```
    </TabItem>
    <TabItem value="Dagger Shell">
    ```shell title="First type 'dagger' for interactive mode."
    build https://github.com/dockersamples/python-flask-redis
    ```
    </TabItem>
    <TabItem value="Dagger CLI">
    ```shell
    dagger call build --src="https://github.com/dockersamples/python-flask-redis"
    ```
    </TabItem>
    </Tabs>

### Build image from Dockerfile using different build context

The following function builds an image from a Dockerfile with a build context that is different than the current working directory.

<Tabs groupId="language" queryString="sdk">
<TabItem value="go" label="Go">

```go file=./snippets/builds/dockerfile-context/go/main.go
```

</TabItem>
<TabItem value="python" label="Python">

```python file=./snippets/builds/dockerfile-context/python/main.py
```

</TabItem>
<TabItem value="typescript" label="TypeScript">

```typescript file=./snippets/builds/dockerfile-context/typescript/index.ts
```

</TabItem>
</Tabs>

#### Example

Build an image from the source code in `https://github.com/dockersamples/python-flask-redis` using the Dockerfile from a different build context, at `https://github.com/vimagick/dockerfiles#master:registry-cli/Dockerfile`:

    <Tabs groupId="shell">
    <TabItem value="System shell">
    ```shell
    dagger -c 'build https://github.com/dockersamples/python-flask-redis https://github.com/vimagick/dockerfiles#master:registry-cli/Dockerfile'
    ```
    </TabItem>
    <TabItem value="Dagger Shell">
    ```shell title="First type 'dagger' for interactive mode."
    build https://github.com/dockersamples/python-flask-redis https://github.com/vimagick/dockerfiles#master:registry-cli/Dockerfile
    ```
    </TabItem>
    <TabItem value="Dagger CLI">
    ```shell
    dagger call \
      build --src="https://github.com/dockersamples/python-flask-redis" \
        --dockerfile=https://github.com/vimagick/dockerfiles#master:registry-cli/Dockerfile
    ```
    </TabItem>
    </Tabs>

### Add OCI annotations to image

The following Dagger Function adds [OpenContainer Initiative (OCI) annotations](https://github.com/opencontainers/image-spec/blob/main/annotations.md) to an image.

<Tabs groupId="language" queryString="sdk">
<TabItem value="go" label="Go">

```go file=./snippets/builds/oci-annotations/go/main.go
```

</TabItem>
<TabItem value="python" label="Python">

```python file=./snippets/builds/oci-annotations/python/main.py
```

</TabItem>
<TabItem value="typescript" label="TypeScript">

```typescript file=./snippets/builds/oci-annotations/typescript/index.ts
```

</TabItem>
</Tabs>

#### Example

Build and publish an image with OCI annotations:

    <Tabs groupId="shell">
    <TabItem value="System shell">
    ```shell
    dagger -c build
    ```
    </TabItem>
    <TabItem value="Dagger Shell">
    ```shell title="First type 'dagger' for interactive mode."
    build
    ```
    </TabItem>
    <TabItem value="Dagger CLI">
    ```shell
    dagger call build
    ```
    </TabItem>
    </Tabs>

### Add OCI labels to image

The following Dagger Function adds [OpenContainer Initiative (OCI) labels](https://github.com/opencontainers/image-spec/blob/main/config.md) to an image.

<Tabs groupId="language" queryString="sdk">
<TabItem value="go" label="Go">

```go file=./snippets/builds/oci-labels/go/main.go
```

</TabItem>
<TabItem value="python" label="Python">

```python file=./snippets/builds/oci-labels/python/main.py
```

</TabItem>
<TabItem value="typescript" label="TypeScript">

```typescript file=./snippets/builds/oci-labels/typescript/index.ts
```

</TabItem>
</Tabs>

#### Example

Build and publish an image with OCI labels:

    <Tabs groupId="shell">
    <TabItem value="System shell">
    ```shell
    dagger -c build
    ```
    </TabItem>
    <TabItem value="Dagger Shell">
    ```shell title="First type 'dagger' for interactive mode."
    build
    ```
    </TabItem>
    <TabItem value="Dagger CLI">
    ```shell
    dagger call build
    ```
    </TabItem>
    </Tabs>

### Invalidate cache

The following function demonstrates how to invalidate the Dagger layer cache and force execution of subsequent workflow steps, by introducing a volatile time variable at a specific point in the Dagger workflow.

:::note
* This is a temporary workaround until cache invalidation support is officially added to Dagger.
* Changes in mounted cache volumes or secrets do not invalidate the Dagger layer cache.
:::

<Tabs groupId="language" queryString="sdk">
<TabItem value="go" label="Go">

```go file=./snippets/builds/cache/go/main.go
```

</TabItem>
<TabItem value="python" label="Python">

```python file=./snippets/builds/cache/python/main.py
```

</TabItem>
<TabItem value="typescript" label="TypeScript">

```typescript file=./snippets/builds/cache/typescript/index.ts
```

</TabItem>
<TabItem value="php" label="PHP">

```php file=./snippets/builds/cache/php/src/MyModule.php
```

</TabItem>
</Tabs>

#### Example

Print the date and time, invalidating the cache on each run. However, if the `CACHEBUSTER` environment variable is removed, the same value (the date and time on the first run) is printed on every run.

    <Tabs groupId="shell">
    <TabItem value="System shell">
    ```shell
    dagger -c build
    ```
    </TabItem>
    <TabItem value="Dagger Shell">
    ```shell title="First type 'dagger' for interactive mode."
    build
    ```
    </TabItem>
    <TabItem value="Dagger CLI">
    ```shell
    dagger call build
    ```
    </TabItem>
    </Tabs>
