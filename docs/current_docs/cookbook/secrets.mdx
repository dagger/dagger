---
title: "Secrets"
slug: /cookbook/secrets
description: "Learn how to manage secrets in your applications using Dagger with practical examples."
sidebar_label: "Secrets"
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

### Use secret variables

The following Dagger Function accepts a GitHub personal access token as a `Secret`, and uses the `Secret` to authorize a request to the GitHub API. The secret may be sourced from the host (via an environment variable, host file, or host command) or from an external secrets manager (1Password or Vault):

<Tabs groupId="language" queryString="sdk">
<TabItem value="go" label="Go">

```go file=./snippets/secret-variable/go/main.go
```

</TabItem>
<TabItem value="python" label="Python">

```python file=./snippets/secret-variable/python/main.py
```

</TabItem>
<TabItem value="typescript" label="TypeScript">

```typescript file=./snippets/secret-variable/typescript/index.ts
```

</TabItem>
</Tabs>

#### Examples

- Use a secret sourced from an environment variable:

    <Tabs groupId="shell">
    <TabItem value="System shell">
    ```shell
    dagger -c 'github-api env://GITHUB_API_TOKEN'
    ```
    </TabItem>
    <TabItem value="Dagger Shell">
    ```shell title="First type 'dagger' for interactive mode."
    github-api env://GITHUB_API_TOKEN
    ```
    </TabItem>
    <TabItem value="Dagger CLI">
    ```shell
    dagger call github-api --token=env://GITHUB_API_TOKEN
    ```
    </TabItem>
    </Tabs>

- Use a secret sourced from a file:

    <Tabs groupId="shell">
    <TabItem value="System shell">
    ```shell
    dagger -c 'github-api file://./github.txt'
    ```
    </TabItem>
    <TabItem value="Dagger Shell">
    ```shell title="First type 'dagger' for interactive mode."
    github-api file://./github.txt
    ```
    </TabItem>
    <TabItem value="Dagger CLI">
    ```shell
    dagger call github-api --token=file://./github.txt
    ```
    </TabItem>
    </Tabs>

- Use a secret sourced from a command:

    <Tabs groupId="shell">
    <TabItem value="System shell">
    ```shell
    dagger -c 'github-api cmd://"gh auth token"'
    ```
    </TabItem>
    <TabItem value="Dagger Shell">
    ```shell title="First type 'dagger' for interactive mode."
    github-api cmd://"gh auth token"
    ```
    </TabItem>
    <TabItem value="Dagger CLI">
    ```shell
    dagger call github-api --token=cmd://"gh auth token"
    ```
    </TabItem>
    </Tabs>

- Use a secret from 1Password:

  :::note
  If using a [1Password service account](https://developer.1password.com/docs/service-accounts/), ensure that the `OP_SERVICE_ACCOUNT_TOKEN` environment variable is set.

    ```shell
    export OP_SERVICE_ACCOUNT_TOKEN="mytoken"
    ```
  :::

    <Tabs groupId="shell">
    <TabItem value="System shell">
    ```shell
    dagger -c 'github-api op://infra/github/credential'
    ```
    </TabItem>
    <TabItem value="Dagger Shell">
    ```shell title="First type 'dagger' for interactive mode."
    github-api op://infra/github/credential
    ```
    </TabItem>
    <TabItem value="Dagger CLI">
    ```shell
    dagger call github-api --token=op://infra/github/credential
    ```
    </TabItem>
    </Tabs>

- Use a secret from Vault:

  :::note
  Ensure that the `VAULT_ADDR` and either the `VAULT_TOKEN` or `VAULT_APPROLE_ROLE_ID` (for [Vault AppRole authentication](https://developer.hashicorp.com/vault/docs/auth/approle)) environment variables are set.

    ```shell
    export VAULT_ADDR="https://127.0.0.1:8200"
    export VAULT_TOKEN="gue55me7"
    export VAULT_APPROLE_ROLE_ID="roleid-xxx-yyy-zzz"
    ```
  :::

    <Tabs groupId="shell">
    <TabItem value="System shell">
    ```shell
    dagger -c 'github-api vault://credentials.github'
    ```
    </TabItem>
    <TabItem value="Dagger Shell">
    ```shell title="First type 'dagger' for interactive mode."
    github-api vault://credentials.github
    ```
    </TabItem>
    <TabItem value="Dagger CLI">
    ```shell
    dagger call github-api --token=vault://credentials.github
    ```
    </TabItem>
    </Tabs>

### Mount files as secrets

The following Dagger Function accepts a GitHub hosts configuration file as a `Secret`, and mounts the file as a `Secret` to a container to authorize a request to GitHub.

<Tabs groupId="language" queryString="sdk">
<TabItem value="go" label="Go">

```go file=./snippets/secret-file/go/main.go
```

</TabItem>
<TabItem value="python" label="Python">

```python file=./snippets/secret-file/python/main.py
```

</TabItem>
<TabItem value="typescript" label="TypeScript">

```typescript file=./snippets/secret-file/typescript/index.ts
```

</TabItem>
</Tabs>

#### Example

Use a mounted secret file:

    <Tabs groupId="shell">
    <TabItem value="System shell">
    ```shell
    dagger -c 'github-auth file://$HOME/.config/gh/hosts.yml'
    ```
    </TabItem>
    <TabItem value="Dagger Shell">
    ```shell title="First type 'dagger' for interactive mode."
    github-auth file://$HOME/.config/gh/hosts.yml
    ```
    </TabItem>
    <TabItem value="Dagger CLI">
    ```shell
    dagger call github-auth --gh-creds=file://$HOME/.config/gh/hosts.yml
    ```
    </TabItem>
    </Tabs>

### Use secret in Dockerfile build

The following code listing demonstrates how to inject a secret into a Dockerfile build. The secret is automatically mounted in the build container at `/run/secrets/SECRET-ID`.

<Tabs groupId="language" queryString="sdk">
<TabItem value="go" label="Go">

```go file=./snippets/secret-dockerfile/go/main.go
```

</TabItem>
<TabItem value="python" label="Python">

```python file=./snippets/secret-dockerfile/python/main.py
```

</TabItem>
<TabItem value="typescript" label="TypeScript">

```typescript file=./snippets/secret-dockerfile/typescript/index.ts
```

</TabItem>
</Tabs>

The sample Dockerfile below demonstrates the process of mounting the secret using a secret filesystem mount type and using it in the Dockerfile build process:

```shell
FROM alpine:3.17
RUN apk add curl
RUN --mount=type=secret,id=gh-secret \
    curl "https://api.github.com/repos/dagger/dagger/issues" \
        --header "Accept: application/vnd.github+json" \
        --header "Authorization: Bearer $(cat /run/secrets/gh-secret)"
```

#### Example

Build from a Dockerfile with a mounted secret from the host environment:

    <Tabs groupId="shell">
    <TabItem value="System shell">
    ```shell
    dagger -c 'build . env://GITHUB_API_TOKEN'
    ```
    </TabItem>
    <TabItem value="Dagger Shell">
    ```shell title="First type 'dagger' for interactive mode."
    build . env://GITHUB_API_TOKEN
    ```
    </TabItem>
    <TabItem value="Dagger CLI">
    ```shell
    dagger call build --source=. --secret=env://GITHUB_API_TOKEN
    ```
    </TabItem>
    </Tabs>

### Customize secret caching behavior

By default, the layer cache entries for operations that include a secret will be based on the plaintext value of the secret. Operations that include secrets with the same plaintext value may share cache entries, but if the plaintext differs then the operation will not share cache entries.

In some cases, users may desire that operations share the layer cache entries even if the secret plaintext value is different. For example, a secret may often rotate in plaintext value but not be meaningfully different; in these cases, it should still be possible to reuse the cache for operations that include that secret.

For these use cases, the optional `cacheKey` argument to `Secret` construction can be used to specify the "cache key" of the secret. Secrets that share the same `cacheKey` will be considered equivalent when checking the layer cache for operations that include them, even if their plaintext value differs.

#### Example

Use a secret with a specified cache key:

<Tabs groupId="shell">
<TabItem value="System shell">
```shell
dagger -c 'github-api $(secret env://GITHUB_API_TOKEN --cache-key my-cache-key)'
```
</TabItem>
<TabItem value="Dagger Shell">
```shell title="First type 'dagger' for interactive mode."
github-api $(secret env://GITHUB_API_TOKEN --cache-key my-cache-key)
```
</TabItem>
<TabItem value="Dagger CLI">
```shell
dagger call github-api --token=env://GITHUB_API_TOKEN?cacheKey=my-cache-key
```
</TabItem>
</Tabs>
