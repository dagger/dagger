---
slug: /guides/ci/git-credential-helpers
---

# Git Credential Helpers in CI

This guide explains how to configure Git credential helpers for private repository access in CI environments, with specific patterns for GitLab, GitHub, and Bitbucket.

## General Best Practices

When working with private Git repositories in CI:

1. Start with a draft PR
   - Create your changes in a draft PR first
   - This allows for early feedback while indicating work is in progress

2. Focus on local testing
   - Test your changes locally before CI
   - Use `dagger call` to verify your pipeline works
   - Ignore CI results until your local tests pass

3. Wait for confirmation
   - Keep PR in draft status until ready for review
   - Get explicit confirmation before marking as ready
   - Ensure all local tests pass first

4. Maintain clean history
   - Rebase on main before updates
   - Force-push to your branch after changes
   - Keep commits focused and well-organized

## Platform-Specific Patterns

### GitLab CI

GitLab CI offers two recommended approaches for Git authentication:

1. Using credential helper script:
```yaml
script:
  - |
    cat > /tmp/git-credential-helper.sh << 'EOF'
    #!/bin/sh
    case "$1" in
        get)
            echo "protocol=https"
            echo "username=gitlab-ci-token"
            echo "password=$CI_JOB_TOKEN"
            ;;
    esac
    exit 0
    EOF
  - chmod +x /tmp/git-credential-helper.sh
  - git config --system credential."https://gitlab.example.com".helper "/tmp/git-credential-helper.sh"
```

2. Using cache helper (more concise):
```yaml
- git config --global credential."${CI_SERVER_URL}".helper "cache --timeout=${CI_JOB_TIMEOUT}"
- |
  git credential approve << EOT
  url=${CI_SERVER_URL}
  username=gitlab-ci-token
  password=${CI_JOB_TOKEN}
  EOT
```

### GitHub Actions

GitHub Actions supports two main authentication patterns:

1. Using Personal Access Token (PAT):
```yaml
- name: Configure Git credentials
  run: |
    git config --global credential.helper store
    echo "https://x-access-token:${GITHUB_TOKEN}@github.com" > ~/.git-credentials
```

2. Using SSH authentication:
```yaml
- name: Set up SSH
  run: |
    eval "$(ssh-agent -s)"
    ssh-add - <<< '${{ secrets.SSH_PRIVATE_KEY }}'
```

### Bitbucket

Bitbucket requires specific credential helper configuration:

```yaml
- name: Configure Git credentials
  run: |
    git config --global credential.helper "!f() { echo 'username=x-token-auth'; echo 'password=$BITBUCKET_TOKEN'; }; f"
    git config --global credential.https://bitbucket.org.username x-token-auth
    git config --global credential.useHttpPath true
```

## Security Considerations

1. Token Security
   - Never embed credentials in URLs
   - Use credential helpers or environment variables
   - Avoid logging credentials in CI output

2. Token Permissions
   - Use minimal required permissions
   - Consider using deploy tokens for read-only access
   - Rotate tokens regularly

## Troubleshooting

Common issues and solutions:

1. Authentication Failures
   - Verify token permissions
   - Check token expiration
   - Ensure correct username format for platform

2. Git Configuration
   - Use `--system` for system-wide settings
   - Use `--global` for user-specific settings
   - Check credential helper path is correct

## Resources

- [GitLab CI/CD Variables](https://docs.gitlab.com/ee/ci/variables/)
- [GitHub Actions Secrets](https://docs.github.com/en/actions/security-guides/encrypted-secrets)
- [Bitbucket Access Tokens](https://support.atlassian.com/bitbucket-cloud/docs/app-passwords/)
