---
slug: /guides/ci/git-credential-helpers
---

# Git Credential Helpers in CI

This guide explains how to configure Git credential helpers for private repository access in CI environments, with specific patterns for GitLab, GitHub, and Bitbucket.

## Platform-Specific Patterns

### GitLab CI

GitLab CI offers two recommended approaches for Git authentication:

Note: When using CI_JOB_TOKEN, ensure it has sufficient permissions for accessing private repositories and modules. For self-hosted GitLab instances, adjust the server URL accordingly.

1. Using credential helper script:
```yaml
script:
  - |
    cat > /tmp/git-credential-helper.sh << 'EOF'
    #!/bin/sh
    case "$1" in
        get)
            echo "protocol=https"
            echo "username=gitlab-ci-token"
            echo "password=$CI_JOB_TOKEN"
            ;;
    esac
    exit 0
    EOF
  - chmod +x /tmp/git-credential-helper.sh
  - git config --system credential."https://gitlab.example.com".helper "/tmp/git-credential-helper.sh"
```

2. Using cache helper (more concise):
```yaml
- git config --global credential."${CI_SERVER_URL}".helper "cache --timeout=${CI_JOB_TIMEOUT}"
- |
  git credential approve << EOT
  url=${CI_SERVER_URL}
  username=gitlab-ci-token
  password=${CI_JOB_TOKEN}
  EOT
```

### GitHub Actions

GitHub Actions supports two main authentication patterns:

Note: For organization repositories, ensure the GITHUB_TOKEN has appropriate repository access permissions. For cross-repository access, you may need to use a Personal Access Token (PAT) with appropriate scopes.

1. Using Personal Access Token (PAT):
```yaml
- name: Configure Git credentials
  run: |
    git config --global credential.helper store
    echo "https://x-access-token:${GITHUB_TOKEN}@github.com" > ~/.git-credentials
```

2. Using SSH authentication:
```yaml
- name: Set up SSH
  run: |
    eval "$(ssh-agent -s)"
    ssh-add - <<< '${{ secrets.SSH_PRIVATE_KEY }}'
```

### Bitbucket

Bitbucket requires specific credential helper configuration:

Note: When using Bitbucket Pipelines, ensure your APP_PASSWORD has the appropriate repository read/write permissions. For workspace repositories, adjust the configuration accordingly.

```yaml
- name: Configure Git credentials
  run: |
    git config --global credential.helper "!f() { echo 'username=x-token-auth'; echo 'password=$BITBUCKET_TOKEN'; }; f"
    git config --global credential.https://bitbucket.org.username x-token-auth
    git config --global credential.useHttpPath true
```

## Private Module Access

When working with private Dagger modules in CI environments, each platform requires specific configurations:

### GitLab CI Private Modules

For accessing private modules in GitLab CI:
```yaml
# Configure git for private module access
before_script:
  - |
    git config --global credential.helper store
    echo "https://gitlab-ci-token:${CI_JOB_TOKEN}@${CI_SERVER_HOST}" > ~/.git-credentials
    chmod 600 ~/.git-credentials

# Example usage with private module
script:
  - dagger call -m ${CI_SERVER_URL}/your-org/private-module test
```

### GitHub Actions Private Modules

For accessing private modules in GitHub Actions:
```yaml
# Configure git for private module access
- name: Setup Git credentials
  run: |
    git config --global credential.helper store
    echo "https://x-access-token:${GITHUB_TOKEN}@github.com" > ~/.git-credentials
    chmod 600 ~/.git-credentials

# Example usage with private module
- name: Run private module
  run: dagger call -m github.com/your-org/private-module test
```

### Bitbucket Private Modules

For accessing private modules in Bitbucket Pipelines:
```yaml
# Configure git for private module access
- step:
    script:
      - |
        git config --global credential.helper store
        echo "https://${BITBUCKET_USER}:${APP_PASSWORD}@bitbucket.org" > ~/.git-credentials
        chmod 600 ~/.git-credentials

        # Example usage with private module
        dagger call -m bitbucket.org/your-workspace/private-module test
```

## Security Considerations

1. Token Security
   - Never embed credentials in URLs
   - Use credential helpers or environment variables
   - Avoid logging credentials in CI output

2. Token Permissions
   - Use minimal required permissions
   - Consider using deploy tokens for read-only access
   - Rotate tokens regularly

## Troubleshooting

Common issues and solutions:

1. Authentication Failures
   - Verify token permissions
   - Check token expiration
   - Ensure correct username format for platform

2. Git Configuration
   - Use `--system` for system-wide settings
   - Use `--global` for user-specific settings
   - Check credential helper path is correct

## Resources

- [GitLab CI/CD Variables](https://docs.gitlab.com/ee/ci/variables/)
- [GitHub Actions Secrets](https://docs.github.com/en/actions/security-guides/encrypted-secrets)
- [Bitbucket Access Tokens](https://support.atlassian.com/bitbucket-cloud/docs/app-passwords/)
