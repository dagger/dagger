stages:
  - build

.dagger:
  image: golang:1.20
  tags:
    - dagger
  variables:
    "_EXPERIMENTAL_DAGGER_RUNNER_HOST": "unix:///var/run/dagger/buildkitd.sock"
  before_script:
    - cd /tmp
    - curl -L https://dl.dagger.io/dagger/install.sh | DAGGER_VERSION=0.10.2 sh
    # Dagger version must match version in values.yaml
    - export PATH=$PATH:/tmp/
build:
  extends: [.dagger]
  script:
    # assumes a Go project
    # modify to use different function(s) as needed
    - dagger -m github.com/kpenfound/dagger-modules/golang@v0.1.5 call build --project=. --args=.
