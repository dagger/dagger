package main

import (
	"github.com/dagger/cloak/dagger"
)

// AUTOGENERATED BY DAGGER
// func Deploy(ctx *dagger.Context, siteName string) error {
//	 return dagger.Do(ctx, "MAGICMAGIC/netlify", "deploy", "{siteName: xxx}")
// }

func main() {
	dg := dagger.New()

	// actions: test: ...
	dg.Action("test", func(ctx *dagger.Context, input *dagger.Input) (*dagger.Output, error) {
		if err := dagger.DummyRun(ctx, "echo testing"); err != nil {
			return nil, err
		}

		out := &dagger.Output{}
		out.Set("ci")
		return out, nil
	})

	// actions: deploy: {
	//  _build: ...
	// _deploy: netlify.#Deploy & { ... }
	// }
	dg.Action("deploy", func(ctx *dagger.Context, input *dagger.Input) (*dagger.Output, error) {
		// netlify.Deploy(yarn.Install().Script("build"))
		if err := dagger.DummyRun(ctx, "echo building from CI"); err != nil {
			return nil, err
		}

		// FIXME: should be `netlify.Deploy()`
		// PSEUDO EXAMPLE:
		// site := netlify.Deploy(ctx, yarn.Build(), netlify.Options{
		// 	Team: "blocklayer"
		// })
		// url := site.DeployURL
		return dagger.Do(ctx, "localhost:5555/netlify", "deploy", "")
	})

	if err := dg.Serve(); err != nil {
		panic(err)
	}
}
