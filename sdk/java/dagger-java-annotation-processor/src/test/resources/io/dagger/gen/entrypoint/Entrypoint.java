// This class has been generated by dagger-java-sdk. DO NOT EDIT.
package io.dagger.gen.entrypoint;

import static io.dagger.client.Dagger.dag;

import io.dagger.client.Container;
import io.dagger.client.Directory;
import io.dagger.client.Function;
import io.dagger.client.FunctionCall;
import io.dagger.client.FunctionCallArgValue;
import io.dagger.client.JSON;
import io.dagger.client.JsonConverter;
import io.dagger.client.Module;
import io.dagger.client.ModuleID;
import io.dagger.client.Platform;
import io.dagger.client.TypeDef;
import io.dagger.client.TypeDefKind;
import io.dagger.client.exception.DaggerExecException;
import io.dagger.client.exception.DaggerQueryException;
import io.dagger.client.telemetry.Telemetry;
import io.dagger.java.module.DaggerJava;
import java.lang.Class;
import java.lang.Error;
import java.lang.Exception;
import java.lang.Integer;
import java.lang.InterruptedException;
import java.lang.String;
import java.lang.Void;
import java.lang.reflect.InvocationTargetException;
import java.util.Arrays;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Objects;
import java.util.Optional;
import java.util.concurrent.ExecutionException;

public class Entrypoint {
  Entrypoint() {}

  public static void main(String[] args) throws Exception {
    try (Telemetry telemetry = new Telemetry()) {
      new Entrypoint().dispatch(dag().currentFunctionCall());
    } finally {
      dag().close();
    }
  }

  private Void dispatch(FunctionCall fnCall) throws Exception {
    try {
      String parentName = fnCall.parentName();
      String fnName = fnCall.name();
      JSON parentJson = fnCall.parent();
      List<FunctionCallArgValue> fnArgs = fnCall.inputArgs();
      Map<String, JSON> inputArgs = new HashMap<>();
      for (FunctionCallArgValue fnArg : fnArgs) {
        inputArgs.put(fnArg.name(), fnArg.value());
      }

      JSON result;
      if (parentName.isEmpty()) {
        ModuleID modID = register();
        result = JsonConverter.toJSON(modID);
      } else {
        result = invoke(parentJson, parentName, fnName, inputArgs);
      }

      fnCall.returnValue(result);
      return null;
    } catch (InvocationTargetException e) {
      fnCall.returnError(dag().error(e.getTargetException().getMessage()));
      throw e;
    } catch (DaggerExecException e) {
      fnCall.returnError(dag().error(e.getMessage()).withValue("stdout", JsonConverter.toJSON(e.getStdOut())).withValue("stderr", JsonConverter.toJSON(e.getStdErr())).withValue("cmd", JsonConverter.toJSON(e.getCmd())).withValue("exitCode", JsonConverter.toJSON(e.getExitCode())).withValue("path", JsonConverter.toJSON(e.getPath())));
      throw e;
    } catch (Exception e) {
      fnCall.returnError(dag().error(e.getMessage()));
      throw e;
    }
  }

  private ModuleID register()
      throws ExecutionException, DaggerQueryException, InterruptedException {
    Module module = dag().module().withDescription("Dagger Java Module example").withObject(dag()
        .typeDef()
        .withObject("DaggerJava",
            new TypeDef.WithObjectArguments().withDescription("Dagger Java Module main object"))
        .withFunction(dag().function("containerEcho", dag().typeDef().withObject("Container"))
            .withDescription("Returns a container that echoes whatever string argument is provided")
            .withArg("stringArg", dag().typeDef().withKind(TypeDefKind.STRING_KIND),
                new Function.WithArgArguments().withDescription("string to echo")
                    .withDefaultValue(JSON.from("\"Hello Dagger\""))))
        .withFunction(dag().function("grepDir", dag().typeDef().withKind(TypeDefKind.STRING_KIND))
            .withDescription(
                "Returns lines that match a pattern in the files of the provided Directory")
            .withArg("directoryArg", dag().typeDef().withObject("Directory"),
                new Function.WithArgArguments().withDescription("Directory to grep")
                    .withDefaultPath("sdk/java").withIgnore(List.of("**", "!*.java")))
            .withArg("pattern",
                dag().typeDef().withKind(TypeDefKind.STRING_KIND).withOptional(true),
                new Function.WithArgArguments()
                    .withDescription("Pattern to search for in the directory")))
        .withFunction(dag().function("itself", dag().typeDef().withObject("DaggerJava")))
        .withFunction(dag().function("isZero", dag().typeDef().withKind(TypeDefKind.BOOLEAN_KIND))
            .withDescription("but this description should be exposed").withArg("value",
                dag().typeDef().withKind(TypeDefKind.INTEGER_KIND)))
        .withFunction(dag()
            .function("doThings",
                dag().typeDef().withListOf(dag().typeDef().withKind(TypeDefKind.INTEGER_KIND)))
            .withArg("stringArray",
                dag().typeDef().withListOf(dag().typeDef().withKind(TypeDefKind.STRING_KIND)))
            .withArg("ints",
                dag().typeDef().withListOf(dag().typeDef().withKind(TypeDefKind.INTEGER_KIND)))
            .withArg("containers",
                dag().typeDef().withListOf(dag().typeDef().withObject("Container"))))
        .withFunction(dag()
            .function("nonNullableNoDefault", dag().typeDef().withKind(TypeDefKind.STRING_KIND))
            .withDescription("User must provide the argument")
            .withArg("stringArg", dag().typeDef().withKind(TypeDefKind.STRING_KIND)))
        .withFunction(dag()
            .function("nonNullableDefault", dag().typeDef().withKind(TypeDefKind.STRING_KIND))
            .withDescription(
                "If the user doesn't provide an argument, a default value is used. The argument can't be null.")
            .withArg("stringArg", dag().typeDef().withKind(TypeDefKind.STRING_KIND),
                new Function.WithArgArguments().withDefaultValue(JSON.from("\"default value\""))))
        .withFunction(dag().function("nullable", dag().typeDef().withKind(TypeDefKind.STRING_KIND))
            .withDescription(
                "Make it optional but do not define a value. If the user doesn't provide an argument, it will be\n"
                    + " set to null.")
            .withArg("stringArg",
                dag().typeDef().withKind(TypeDefKind.STRING_KIND).withOptional(true)))
        .withFunction(dag()
            .function("nullableDefault", dag().typeDef().withKind(TypeDefKind.STRING_KIND))
            .withDescription(
                "Set a default value in case the user doesn't provide a value and allow for null value.")
            .withArg("stringArg",
                dag().typeDef().withKind(TypeDefKind.STRING_KIND).withOptional(true),
                new Function.WithArgArguments().withDefaultValue(JSON.from("\"Foo\""))))
        .withFunction(dag().function("defaultPlatform", dag().typeDef().withScalar("Platform"))
            .withDescription("return the default platform as a Scalar value"))
        .withFunction(dag().function("addFloat", dag().typeDef().withKind(TypeDefKind.FLOAT_KIND))
            .withArg("a", dag().typeDef().withKind(TypeDefKind.FLOAT_KIND))
            .withArg("b", dag().typeDef().withKind(TypeDefKind.FLOAT_KIND)))
        .withFunction(dag()
            .function("doSomething",
                dag().typeDef().withKind(TypeDefKind.VOID_KIND).withOptional(true))
            .withDescription("Function returning nothing")
            .withArg("src", dag().typeDef().withObject("Directory")))
        .withFunction(
            dag().function("printSeverity", dag().typeDef().withKind(TypeDefKind.STRING_KIND))
                .withArg("severity", dag().typeDef().withEnum("Severity")))
        .withFunction(
            dag().function("validate", dag().typeDef().withKind(TypeDefKind.VOID_KIND).withOptional(true))
                .withDescription("Validates the module configuration")
                .withCheck())
        .withField("source", dag().typeDef().withObject("Directory"),
            new TypeDef.WithFieldArguments().withDescription("Project source directory"))
        .withField("version", dag().typeDef().withKind(TypeDefKind.STRING_KIND))
        .withConstructor(dag().function("", dag().typeDef().withObject("DaggerJava"))
            .withDescription("Initialize the DaggerJava Module")
            .withArg("source", dag().typeDef().withObject("Directory").withOptional(true),
                new Function.WithArgArguments().withDescription("Project source directory"))
            .withArg("version", dag().typeDef().withKind(TypeDefKind.STRING_KIND),
                new Function.WithArgArguments().withDescription("Go version")
                    .withDefaultValue(JSON.from("\"1.23.2\"")))))
        .withEnum(dag().typeDef()
            .withEnum("Severity", new TypeDef.WithEnumArguments().withDescription("Severities"))
            .withEnumValue("DEBUG",
                new TypeDef.WithEnumValueArguments().withDescription("Debug severity"))
            .withEnumValue("INFO",
                new TypeDef.WithEnumValueArguments().withDescription("Info severity"))
            .withEnumValue("WARN").withEnumValue("ERROR").withEnumValue("FATAL"));
    return module.id();
  }

  private JSON invoke(JSON parentJson, String parentName, String fnName,
      Map<String, JSON> inputArgs) throws Exception {
    if (parentName.equals("DaggerJava")) {
      if (fnName.equals("containerEcho")) {
        Class clazz = Class.forName("io.dagger.java.module.DaggerJava");
        DaggerJava obj = (DaggerJava) JsonConverter.fromJSON(parentJson, clazz);
        String stringArg = null;
        if (inputArgs.get("stringArg") != null) {
          stringArg = JsonConverter.fromJSON(inputArgs.get("stringArg"), String.class);
        }
        Objects.requireNonNull(stringArg, "stringArg must not be null");
        Container res = obj.containerEcho(stringArg);
        return JsonConverter.toJSON(res);
      } else if (fnName.equals("grepDir")) {
        Class clazz = Class.forName("io.dagger.java.module.DaggerJava");
        DaggerJava obj = (DaggerJava) JsonConverter.fromJSON(parentJson, clazz);
        Directory directoryArg = null;
        if (inputArgs.get("directoryArg") != null) {
          directoryArg = JsonConverter.fromJSON(inputArgs.get("directoryArg"), Directory.class);
        }
        Objects.requireNonNull(directoryArg, "directoryArg must not be null");
        String pattern = null;
        if (inputArgs.get("pattern") != null) {
          pattern = JsonConverter.fromJSON(inputArgs.get("pattern"), String.class);
        }
        var pattern_opt = Optional.ofNullable(pattern);
        String res = obj.grepDir(directoryArg, pattern_opt);
        return JsonConverter.toJSON(res);
      } else if (fnName.equals("itself")) {
        Class clazz = Class.forName("io.dagger.java.module.DaggerJava");
        DaggerJava obj = (DaggerJava) JsonConverter.fromJSON(parentJson, clazz);
        DaggerJava res = obj.itself();
        return JsonConverter.toJSON(res);
      } else if (fnName.equals("isZero")) {
        Class clazz = Class.forName("io.dagger.java.module.DaggerJava");
        DaggerJava obj = (DaggerJava) JsonConverter.fromJSON(parentJson, clazz);
        int value = 0;
        if (inputArgs.get("value") != null) {
          value = JsonConverter.fromJSON(inputArgs.get("value"), int.class);
        }
        boolean res = obj.isZero(value);
        return JsonConverter.toJSON(res);
      } else if (fnName.equals("doThings")) {
        Class clazz = Class.forName("io.dagger.java.module.DaggerJava");
        DaggerJava obj = (DaggerJava) JsonConverter.fromJSON(parentJson, clazz);
        String[] stringArray = null;
        if (inputArgs.get("stringArray") != null) {
          stringArray = JsonConverter.fromJSON(inputArgs.get("stringArray"), String[].class);
        }
        Objects.requireNonNull(stringArray, "stringArray must not be null");
        List<Integer> ints = null;
        if (inputArgs.get("ints") != null) {
          ints = Arrays.asList(JsonConverter.fromJSON(inputArgs.get("ints"), Integer[].class));
        }
        Objects.requireNonNull(ints, "ints must not be null");
        List<Container> containers = null;
        if (inputArgs.get("containers") != null) {
          containers =
              Arrays.asList(JsonConverter.fromJSON(inputArgs.get("containers"), Container[].class));
        }
        Objects.requireNonNull(containers, "containers must not be null");
        int[] res = obj.doThings(stringArray, ints, containers);
        return JsonConverter.toJSON(res);
      } else if (fnName.equals("nonNullableNoDefault")) {
        Class clazz = Class.forName("io.dagger.java.module.DaggerJava");
        DaggerJava obj = (DaggerJava) JsonConverter.fromJSON(parentJson, clazz);
        String stringArg = null;
        if (inputArgs.get("stringArg") != null) {
          stringArg = JsonConverter.fromJSON(inputArgs.get("stringArg"), String.class);
        }
        Objects.requireNonNull(stringArg, "stringArg must not be null");
        String res = obj.nonNullableNoDefault(stringArg);
        return JsonConverter.toJSON(res);
      } else if (fnName.equals("nonNullableDefault")) {
        Class clazz = Class.forName("io.dagger.java.module.DaggerJava");
        DaggerJava obj = (DaggerJava) JsonConverter.fromJSON(parentJson, clazz);
        String stringArg = null;
        if (inputArgs.get("stringArg") != null) {
          stringArg = JsonConverter.fromJSON(inputArgs.get("stringArg"), String.class);
        }
        Objects.requireNonNull(stringArg, "stringArg must not be null");
        String res = obj.nonNullableDefault(stringArg);
        return JsonConverter.toJSON(res);
      } else if (fnName.equals("nullable")) {
        Class clazz = Class.forName("io.dagger.java.module.DaggerJava");
        DaggerJava obj = (DaggerJava) JsonConverter.fromJSON(parentJson, clazz);
        String stringArg = null;
        if (inputArgs.get("stringArg") != null) {
          stringArg = JsonConverter.fromJSON(inputArgs.get("stringArg"), String.class);
        }
        var stringArg_opt = Optional.ofNullable(stringArg);
        String res = obj.nullable(stringArg_opt);
        return JsonConverter.toJSON(res);
      } else if (fnName.equals("nullableDefault")) {
        Class clazz = Class.forName("io.dagger.java.module.DaggerJava");
        DaggerJava obj = (DaggerJava) JsonConverter.fromJSON(parentJson, clazz);
        String stringArg = null;
        if (inputArgs.get("stringArg") != null) {
          stringArg = JsonConverter.fromJSON(inputArgs.get("stringArg"), String.class);
        }
        var stringArg_opt = Optional.ofNullable(stringArg);
        String res = obj.nullableDefault(stringArg_opt);
        return JsonConverter.toJSON(res);
      } else if (fnName.equals("defaultPlatform")) {
        Class clazz = Class.forName("io.dagger.java.module.DaggerJava");
        DaggerJava obj = (DaggerJava) JsonConverter.fromJSON(parentJson, clazz);
        Platform res = obj.defaultPlatform();
        return JsonConverter.toJSON(res);
      } else if (fnName.equals("addFloat")) {
        Class clazz = Class.forName("io.dagger.java.module.DaggerJava");
        DaggerJava obj = (DaggerJava) JsonConverter.fromJSON(parentJson, clazz);
        float a = 0;
        if (inputArgs.get("a") != null) {
          a = JsonConverter.fromJSON(inputArgs.get("a"), float.class);
        }
        float b = 0;
        if (inputArgs.get("b") != null) {
          b = JsonConverter.fromJSON(inputArgs.get("b"), float.class);
        }
        float res = obj.addFloat(a, b);
        return JsonConverter.toJSON(res);
      } else if (fnName.equals("doSomething")) {
        Class clazz = Class.forName("io.dagger.java.module.DaggerJava");
        DaggerJava obj = (DaggerJava) JsonConverter.fromJSON(parentJson, clazz);
        Directory src = null;
        if (inputArgs.get("src") != null) {
          src = JsonConverter.fromJSON(inputArgs.get("src"), Directory.class);
        }
        Objects.requireNonNull(src, "src must not be null");
        obj.doSomething(src);
        return JsonConverter.toJSON(null);
      } else if (fnName.equals("printSeverity")) {
        Class clazz = Class.forName("io.dagger.java.module.DaggerJava");
        DaggerJava obj = (DaggerJava) JsonConverter.fromJSON(parentJson, clazz);
        DaggerJava.Severity severity = null;
        if (inputArgs.get("severity") != null) {
          severity = JsonConverter.fromJSON(inputArgs.get("severity"), DaggerJava.Severity.class);
        }
        Objects.requireNonNull(severity, "severity must not be null");
        String res = obj.printSeverity(severity);
        return JsonConverter.toJSON(res);
      } else if (fnName.equals("validate")) {
        Class clazz = Class.forName("io.dagger.java.module.DaggerJava");
        DaggerJava obj = (DaggerJava) JsonConverter.fromJSON(parentJson, clazz);
        obj.validate();
        return JsonConverter.toJSON(null);
      }
      if (fnName.equals("")) {
        Directory source = null;
        if (inputArgs.get("source") != null) {
          source = JsonConverter.fromJSON(inputArgs.get("source"), Directory.class);
        }
        var source_opt = Optional.ofNullable(source);
        String version = null;
        if (inputArgs.get("version") != null) {
          version = JsonConverter.fromJSON(inputArgs.get("version"), String.class);
        }
        Objects.requireNonNull(version, "version must not be null");
        DaggerJava res = new DaggerJava(source_opt, version);
        return JsonConverter.toJSON(res);
      }
    }
    throw new InvocationTargetException(new Error("unknown function " + fnName));
  }
}
