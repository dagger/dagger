"""
Note: For now, this file is not actually generated. Feel free to make edits.
"""
type TestSplit {
  pub source: Directory! @defaultPath(path: "/")

  let testSpecific(
    run: [String!]!,
    pkg: String! = "./core/integration",
  ): Void {
    go
      .env
      .withDirectory("/app", source)
      .withWorkdir("/app")
      .withMountedCache("/run", cacheVolume("integ-test-engine-run"))
      .withExec(
        ["go", "test", pkg, "-run", run.join("|"), "-v", "-count", "1", "-timeout", "30m", "-failfast"],
        experimentalPrivilegedNesting: true,
      )
      .sync

    null
  }

  let testSkip(
    skip: [String!]!,
    ebpfProgs: [String!],
    pkg: String! = "./core/integration",
    race: Boolean,
  ): Void {
    go
      .env
      .withDirectory("/app", source)
      .withWorkdir("/app")
      .withMountedCache("/run", cacheVolume("integ-test-engine-run"))
      .withEnvVariable("CGO_ENABLED", "1")
      .withExec(
        ["go", "test", pkg, "-v", "-skip", skip.join("|"), "-count", "1", "-race", "-timeout", "30m"],
        experimentalPrivilegedNesting: true,
      )
      .sync

    null
  }

  """
  Test Base (lighter tests, excludes heavy suites split into test-base-heavy)
  """
  pub testBase: Void @check {
    testSkip(
      skip: ["TestProvision", "TestTelemetry", "TestModule", "TestGo", "TestPython", "TestTypescript", "TestElixir", "TestPHP", "TestJava", "TestContainer", "TestDockerfile", "TestLLM", "TestCLI", "TestEngine", "TestClientGenerator", "TestInterface", "TestCall", "TestShell", "TestDaggerCMD", "TestWorkspace", "TestGit", "TestRemoteCache", "TestLegacy", "TestServices", "TestPlatform", "TestSecretProvider", "TestConfig"],
      pkg: "./core/integration",
    )
  }

  """
  Test Base Heavy (git, remote cache, services, platform, secret providers, legacy, config)
  """
  pub testBaseHeavy: Void @check {
    testSpecific(["TestGit", "TestGitCredential", "TestRemoteCache", "TestLegacy", "TestServices", "TestPlatform", "TestSecretProvider", "TestConfig"])
  }

  """
  Test Provision
  """
  pub testProvision: Void @check {
    testSpecific(["TestProvision"])
  }

  """
  Test Telemetry
  """
  pub testTelemetry: Void @check {
    testSpecific(["TestTelemetry"], pkg: "./dagql/idtui")
  }

  """
  Test Call and Shell
  """
  pub testCallAndShell: Void @check {
    testSpecific(["TestCall", "TestShell", "TestDaggerCMD"])
  }

  """
  Test CLI Engine
  """
  pub testCliEngine: Void @check {
    testSpecific(["TestCLI", "TestEngine"])
  }

  """
  Test Client Generator
  """
  pub testClientGenerator: Void @check {
    testSpecific(["TestClientGenerator"])
  }

  """
  Test Container (excluding DinD/nested engine tests)
  """
  pub testContainer: Void @check {
    go
      .env
      .withDirectory("/app", source)
      .withWorkdir("/app")
      .withMountedCache("/run", cacheVolume("integ-test-engine-run"))
      .withExec(
        ["go", "test", "./core/integration",
         "-run", "TestContainer|TestDockerfile",
         "-skip", "TestInsecureRootCapabilitesWithService|TestImageLoadCompatibility|TestSaveHostDocker|TestLoadHostDocker|TestSaveHostContainerd|TestLoadHostContainerd|TestLoadSaveNone|TestSaveInNested|TestWithRegistryAuthFileAndDirectoryAccess",
         "-v", "-parallel", "2", "-count", "1", "-timeout", "30m"],
        experimentalPrivilegedNesting: true,
      )
      .sync

    null
  }

  """
  Test Container DinD/nested engine tests (isolated to prevent cascading failures)
  """
  pub testContainerProvision: Void @check {
    testSpecific([
      "TestContainer/TestInsecureRootCapabilitesWithService",
      "TestContainer/TestImageLoadCompatibility",
      "TestContainer/TestSaveHostDocker",
      "TestContainer/TestLoadHostDocker",
      "TestContainer/TestSaveHostContainerd",
      "TestContainer/TestLoadHostContainerd",
      "TestContainer/TestLoadSaveNone",
      "TestContainer/TestSaveInNested",
      "TestContainer/TestWithRegistryAuthFileAndDirectoryAccess",
    ])
  }

  """
  Test Interface
  """
  pub testInterface: Void @check {
    go
      .env
      .withDirectory("/app", source)
      .withWorkdir("/app")
      .withMountedCache("/run", cacheVolume("integ-test-engine-run"))
      .withExec(
        ["go", "test", "./core/integration", "-run", "TestInterface", "-v", "-parallel", "1", "-count", "1", "-timeout", "30m", "-failfast"],
        experimentalPrivilegedNesting: true,
      )
      .sync

    null
  }

  """
  Test LLM
  """
  pub testLlm: Void @check {
    testSpecific(["TestLLM"])
  }

  """
  Test Module Runtimes
  """
  pub testModuleRuntimes: Void @check {
    testSpecific(["TestGo", "TestPython", "TestTypescript", "TestElixir", "TestPHP", "TestJava"])
  }

  """
  Test Modules
  """
  pub testModules: Void @check {
    testSpecific(["TestModule"])
  }

  """
  Test Workspaces
  """
  pub testWorkspaces: Void @check {
    testSpecific(["TestWorkspace"])
  }
}
